<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Optimization on Keqiçš„åšå®¢</title><link>https://keqiye.github.io/zh-cn/categories/optimization/</link><description>Recent content in Optimization on Keqiçš„åšå®¢</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><managingEditor>plloningye@gmail.com (Keqi Ye)</managingEditor><webMaster>plloningye@gmail.com (Keqi Ye)</webMaster><copyright>Example Person</copyright><atom:link href="https://keqiye.github.io/zh-cn/categories/optimization/index.xml" rel="self" type="application/rss+xml"/><item><title>7 Step Optimization of Parallel Reduction with CUDA</title><link>https://keqiye.github.io/zh-cn/posts/parallel-reduction-with-cuda/blog-parallel-reduction-with-cuda/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><author>plloningye@gmail.com (Keqi Ye)</author><guid>https://keqiye.github.io/zh-cn/posts/parallel-reduction-with-cuda/blog-parallel-reduction-with-cuda/</guid><description>&lt;h2 id="å†™åœ¨å‰é¢">å†™åœ¨å‰é¢
&lt;/h2>&lt;blockquote>
&lt;p>ğŸ“š &lt;strong>ç‰ˆæƒå£°æ˜ | Copyright Notice&lt;/strong>&lt;/p>
&lt;p>æœ¬æ–‡å†…å®¹å‚è€ƒå¹¶éƒ¨åˆ†ç¿»è¯‘è‡ªä»¥ä¸‹ä¸¤ç¯‡èµ„æ–™ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;a class="link" href="https://developer.download.nvidia.com/assets/cuda/files/reduction.pdf" target="_blank" rel="noopener"
>NVIDIA å®˜æ–¹ PPTï¼ˆreduction.pdfï¼‰&lt;/a>&lt;/li>
&lt;li>&lt;a class="link" href="https://medium.com/@rimikadhara/7-step-optimization-of-parallel-reduction-with-cuda-33a3b2feafd8" target="_blank" rel="noopener"
>Medium åšå®¢ï¼š7 Step Optimization of Parallel Reduction with CUDA&lt;/a>&lt;/li>
&lt;/ul>
&lt;p>ä¸Šè¿°èµ„æ–™ç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰ã€‚æœ¬æ–‡æ—¨åœ¨å­¦ä¹ å’ŒæŠ€æœ¯ä¼ æ’­ï¼Œä»…ä¾›ä¸ªäººå’Œå­¦æœ¯ä½¿ç”¨ã€‚å¦‚æœ‰ä¾µæƒï¼Œè¯·è”ç³»åˆ é™¤ã€‚&lt;/p>
&lt;p>This article is a study and partial translation based on the works above. All rights belong to the original authors. The content is shared for learning and research purposes only. Please contact for removal if there is any infringement.&lt;/p>
&lt;/blockquote>
&lt;p>âš ï¸ &lt;strong>è‹¥ä¸Šè¿°é“¾æ¥å¤±æ•ˆ&lt;/strong>ï¼Œè¯»è€…å¯ä»¥åœ¨ Google ä¸­ä½¿ç”¨å…³é”®è¯æŸ¥æ‰¾ï¼š&lt;br>
&lt;code>7 Step Optimization of Parallel Reduction with CUDA&lt;/code>&lt;/p>
&lt;p>æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•ä¼˜åŒ– CUDA ä¸­çš„å¹¶è¡Œè§„çº¦ç®—æ³• (Parallel Reduction)ï¼Œå¹¶é€šè¿‡ä¸ƒä¸ªæ­¥éª¤é€æ­¥æå‡æ€§èƒ½ã€‚å°½ç®¡ä¸Šè¿°é“¾æ¥ä¸­ä½œè€…å·²ç»è¯´æ˜çš„ååˆ†æ¸…æ¥šã€‚æˆ‘è¿™é‡Œè¿˜æ˜¯ä¼šä½¿ç”¨ä¸­æ–‡å†èµ°ä¸€è¾¹æµç¨‹ï¼Œä¸€æ¥ä¸ºä¸­æ–‡äº’è”ç½‘æä¾›å‚è€ƒèµ„æ–™ï¼ŒäºŒæ¥ä¸ºæˆ‘è‡ªå·±å­¦ä¹ ã€‚&lt;/p>
&lt;p>CUDAå¹¶è¡Œä»£ç ä¸ä¸²è¡Œä»£ç çš„æ•´ä½“è®¾è®¡æ€è·¯ç›¸å·®å¾ˆå¤§ï¼Œè™½ç„¶æ˜¯æŒ‰ç…§çº¿ç¨‹æ¥ç¼–å†™ï¼Œä½†æ˜¯è¦ä»Blockå±‚é¢å»æ€è€ƒå’Œè®¾è®¡ã€‚&lt;/p>
&lt;h2 id="ä»€ä¹ˆæ˜¯-parallel-reduction-ç®—æ³•">ä»€ä¹ˆæ˜¯ Parallel Reduction ç®—æ³•ï¼Ÿ
&lt;/h2>&lt;p>è®©æˆ‘ä»¬é¦–å…ˆäº†è§£ä¸€ä¸‹ Parallel Reduction ç®—æ³•çš„åŸºæœ¬æ¦‚å¿µã€‚å®ƒæ˜¯ä¸€ç§ &lt;strong>æ•°æ®å¹¶è¡ŒåŸè¯­&lt;/strong>ï¼Œåœ¨ CUDA ä¸­å®ç°ç›¸å¯¹ç›´æ¥ã€‚ç®€å•æ¥è¯´ï¼ŒParallel Reduction çš„ç›®æ ‡æ˜¯é€šè¿‡ GPU çš„çº¿ç¨‹å±‚çº§ç»“æ„å¹¶è¡Œåœ°å¯¹å‘é‡ã€çŸ©é˜µæˆ–å¼ é‡è¿›è¡Œå½’çº¦æ“ä½œã€‚&lt;/p>
&lt;p>è¿™ç§å½’çº¦æ˜¯é€šè¿‡å¦‚ &lt;code>sum()&lt;/code>ã€&lt;code>min()&lt;/code>ã€&lt;code>max()&lt;/code> æˆ– &lt;code>avg()&lt;/code> ç­‰æ“ä½œæ¥å®ç°çš„ï¼Œç”¨äºå¯¹æ•°æ®è¿›è¡Œèšåˆä¸ç®€åŒ–ã€‚äº‹å®ä¸Šï¼Œå¯¹ä¸€ä¸ªæ•°ç»„æ±‚ä¸Šè¿°æ“ä½œæ˜¯ååˆ†ç®€å•çš„ï¼Œå¦‚æœæƒ³å®ç° CUDA å¹¶è¡Œï¼Œæ ¸å¿ƒéš¾åº¦åœ¨äºè®¿å­˜è®¾è®¡ã€‚è‹¥å¤„ç†ä¸å½“ï¼Œå³ä½¿æ˜¯è¿™äº›â€œçœ‹ä¼¼ç®€å•â€çš„è®¡ç®—ä¹Ÿå¯èƒ½å˜å¾—è€—æ—¶ã€‚&lt;/p>
&lt;p>é«˜æ•ˆå®ç° Parallel Reduction çš„ä¸€ä¸ªåŸå› æ˜¯å®ƒä»¬éå¸¸é€šç”¨ï¼Œå¹¶åœ¨è®¸å¤šåº”ç”¨ä¸­èµ·ç€å…³é”®ä½œç”¨ã€‚æˆ‘ä¸»è¦ä½¿ç”¨SPHç ”ç©¶å°è¡Œæ˜Ÿæ’å‡»ï¼Œæ¯ä¸€æ­¥SPHæ±‚è§£è¿‡ç¨‹ä¸­ï¼Œéƒ½éœ€è¦è¿›è¡ŒåŒ…å›´ç›’è®¡ç®—ï¼Œå¯¹åº”ç€ &lt;code>min()&lt;/code>ã€&lt;code>max()&lt;/code> æ“ä½œã€‚&lt;/p>
&lt;h3 id="æ ‘å½¢å½’çº¦æ¨¡å‹tree-based-reduction">æ ‘å½¢å½’çº¦æ¨¡å‹ï¼ˆTree-based Reductionï¼‰
&lt;/h3>&lt;p>å¹¶è¡Œå½’çº¦å¯ä»¥è¢«ç±»æ¯”ä¸ºä¸€ç§â€œæ ‘çŠ¶å½’çº¦â€ï¼ˆtree-based reductionï¼‰è¿‡ç¨‹ï¼šæ•°æ®åœ¨å„çº¿ç¨‹å—ï¼ˆthread blockï¼‰ä¹‹é—´é€å±‚å½’çº¦ã€‚&lt;/p>
&lt;p>ä½†è¿™é‡Œå‡ºç°äº†ä¸€ä¸ªå…³é”®é—®é¢˜ï¼š&lt;/p>
&lt;blockquote>
&lt;p>&lt;strong>æˆ‘ä»¬å¦‚ä½•åœ¨ä¸åŒçº¿ç¨‹å—ä¹‹é—´ä¼ é€’ä¸­é—´ç»“æœï¼Ÿ&lt;/strong>&lt;/p>
&lt;/blockquote>
&lt;p>æœ€ç›´æ¥çš„æƒ³æ³•æ˜¯ä½¿ç”¨â€œå…¨å±€åŒæ­¥ï¼ˆglobal synchronizationï¼‰â€ â€”â€” å…ˆè®©æ¯ä¸ªçº¿ç¨‹å—å®Œæˆä¸€éƒ¨åˆ†è®¡ç®—ï¼Œç„¶åè¿›è¡Œå…¨å±€åŒæ­¥å¹¶ç»§ç»­é€’å½’å¤„ç†ã€‚&lt;/p>
&lt;p>ç„¶è€Œï¼ŒCUDA &lt;strong>å¹¶ä¸æ”¯æŒå…¨å±€åŒæ­¥&lt;/strong>ï¼Œå› ä¸ºè¿™åœ¨ç¡¬ä»¶ä¸Šå¼€é”€æå¤§ï¼Œè¿˜å¯èƒ½å¯¼è‡´æ­»é”ï¼Œåªèƒ½ä½¿ç”¨å°‘é‡çº¿ç¨‹å—ï¼Œé™åˆ¶æ€§èƒ½æå‡ã€‚&lt;/p>
&lt;p>ğŸ“Œ &lt;strong>æ›´å®ç”¨çš„æ–¹æ¡ˆæ˜¯ï¼šKernel åˆ†è§£ï¼ˆKernel Decompositionï¼‰&lt;/strong>&lt;/p>
&lt;h3 id="kernel-åˆ†è§£kernel-decomposition">Kernel åˆ†è§£ï¼ˆKernel Decompositionï¼‰
&lt;/h3>&lt;p>ä¸ºäº†æ›´é«˜æ•ˆåœ°ä¼ é€’çº¿ç¨‹å—é—´çš„ä¸­é—´ç»“æœï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªå¤§çš„ kernel æ‹†åˆ†ä¸ºå¤šä¸ªå° kernelã€‚è¿™ç§åšæ³•è¢«ç§°ä¸º &lt;strong>Kernel åˆ†è§£&lt;/strong>ã€‚&lt;/p>
&lt;p>&lt;img src="https://keqiye.github.io/images/tree-reduction.png"
loading="lazy"
alt="Tree-based Reduction"
>&lt;/p>
&lt;p>Kernel åˆ†è§£çš„ä¼˜åŠ¿åŒ…æ‹¬ï¼š&lt;/p>
&lt;ul>
&lt;li>å‡å°‘ç¡¬ä»¶ä¸è½¯ä»¶å¼€é”€&lt;/li>
&lt;li>æé«˜èµ„æºåˆ©ç”¨ç‡&lt;/li>
&lt;li>é¿å…çº¿ç¨‹å—é—´åŒæ­¥&lt;/li>
&lt;li>æå‡æ•´ä½“æ‰§è¡Œæ•ˆç‡&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h3 id="æ³¨æ„">æ³¨æ„ï¼
&lt;/h3>&lt;p>æœ¬æ–‡é‡ç‚¹è®²è§£è§„çº¦ï¼ˆreductionï¼‰çš„åŸºæœ¬æ€æƒ³ï¼Œè€Œéå®Œæ•´çš„æœ€ç»ˆå®ç°ã€‚å› æ­¤ï¼Œæ¯ä¸ª kernel çš„æ‰§è¡Œç»“æœå¹¶ä¸æ˜¯ä¸€ä¸ªå…¨å±€å•ä¸€å€¼ï¼Œè€Œæ˜¯ &lt;strong>æ¯ä¸ª block å†…éƒ¨çš„è§„çº¦ç»“æœ&lt;/strong>ã€‚&lt;/p>
&lt;p>å…·ä½“æ¥è¯´ï¼š&lt;/p>
&lt;ul>
&lt;li>æ¯ä¸ª block è´Ÿè´£å¤„ç†è‹¥å¹²ä¸ªçº¿ç¨‹çš„(&lt;code>blockDim&lt;/code>)æ•°æ®ï¼Œå¹¶åœ¨ block å†…å®Œæˆä¸€æ¬¡å±€éƒ¨è§„çº¦ï¼›&lt;/li>
&lt;li>æ¯ä¸ª block çš„ç»“æœä¼šè¢«å†™å…¥è¾“å‡ºæ•°ç»„çš„ &lt;code>blockIdx.x&lt;/code> ä½ç½®ï¼›&lt;/li>
&lt;li>å› æ­¤ï¼Œæœ€ç»ˆè¾“å‡ºæ•°ç»„çš„é•¿åº¦ç­‰äº &lt;code>gridDim.x&lt;/code>ï¼ˆå³ block æ•°é‡ï¼‰ï¼Œè€Œä¸æ˜¯å•ä¸ªå…ƒç´ ã€‚&lt;/li>
&lt;/ul>
&lt;hr>
&lt;h3 id="æ€§èƒ½è¡¡é‡æŒ‡æ ‡our-metrics">æ€§èƒ½è¡¡é‡æŒ‡æ ‡ï¼ˆOur Metricsï¼‰
&lt;/h3>&lt;p>æˆ‘ä»¬è¡¡é‡å¹¶è¡Œå½’çº¦ç®—æ³•æ€§èƒ½çš„ä¸¤ä¸ªå…³é”®æŒ‡æ ‡æ˜¯ï¼š&lt;/p>
&lt;ul>
&lt;li>&lt;strong>æ—¶é—´ï¼ˆTimeï¼‰&lt;/strong>&lt;/li>
&lt;li>&lt;strong>å¸¦å®½ï¼ˆBandwidthï¼‰&lt;/strong>&lt;/li>
&lt;/ul>
&lt;p>è¿™ä¸¤ä¸ªæŒ‡æ ‡åæ˜ äº† GPU æ˜¯å¦è¾¾åˆ°äº†å³°å€¼æ€§èƒ½ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨ä»¥ä¸‹ä¸¤æ–¹é¢è¿›è¡Œä¼˜åŒ–ï¼š&lt;/p>
&lt;ol>
&lt;li>&lt;strong>æé«˜æ•°æ®è¯»å†™æ•ˆç‡&lt;/strong>&lt;/li>
&lt;li>&lt;strong>åŠ å¿«è®¡ç®—é€Ÿåº¦ã€æå‡çº¿ç¨‹åˆ©ç”¨ç‡&lt;/strong>&lt;/li>
&lt;/ol>
&lt;p>ä¸€æ®µç†æƒ³çš„ GPU ç¨‹åºï¼Œä¸ä»…è¿è¡Œå¿«é€Ÿï¼Œè¿˜èƒ½ä½¿å¤§å¤šæ•°çº¿ç¨‹éƒ½åœ¨å·¥ä½œã€‚&lt;/p>
&lt;h2 id="reduce-0äº¤é”™å¯»å€æ³•interleaved-addressing">REDUCE-0ï¼šäº¤é”™å¯»å€æ³•ï¼ˆInterleaved Addressingï¼‰
&lt;/h2>&lt;h3 id="æ€è·¯ä»‹ç»">æ€è·¯ä»‹ç»
&lt;/h3>&lt;p>æœ€æœ´ç´ çš„ä¸€ç§å¹¶è¡Œå½’çº¦æ–¹æ³•æ˜¯é‡‡ç”¨â€œäº¤é”™å¯»å€ï¼ˆInterleaved Addressingï¼‰â€ï¼Œä½œä¸ºæˆ‘ä»¬ä¼˜åŒ–è¿‡ç¨‹çš„åŸºç¡€ç‰ˆæœ¬ã€‚åœ¨è¿™ç§æ–¹æ³•ä¸­ï¼š&lt;/p>
&lt;ul>
&lt;li>æ¯ä¸ªçº¿ç¨‹å¤„ç†ä¸€ç»„å…ƒç´ ï¼›&lt;/li>
&lt;li>æ¯è½®å½’çº¦æ—¶ï¼Œçº¿ç¨‹å°†å…¶å½“å‰å€¼ä¸ä¸€æ®µè·ç¦»å†…çš„å¦ä¸€ä¸ªå…ƒç´ å€¼ç›¸åŠ ï¼›&lt;/li>
&lt;li>æ¯è½®æ­¥é•¿åŠ å€ï¼Œç›´åˆ°æœ€ç»ˆå¾—å‡ºè¯¥ block çš„å½’çº¦ç»“æœã€‚&lt;/li>
&lt;/ul>
&lt;p>ğŸ“˜ ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ª 1024 å…ƒç´ æ•°ç»„ï¼Œä½¿ç”¨ 256 çº¿ç¨‹å—ï¼Œæ¯ä¸ªçº¿ç¨‹å¤„ç†å››ä¸ªé—´éš”ä¸º 256 çš„æ•°æ®ç‚¹ã€‚&lt;/p>
&lt;p>è¿™ç§æ–¹å¼å¯ä»¥ç¡®ä¿ï¼š&lt;/p>
&lt;ul>
&lt;li>å„çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œè´Ÿè½½å‡è¡¡ï¼›&lt;/li>
&lt;li>çº¿ç¨‹é—´åŒæ­¥æ›´ç®€å•ï¼›&lt;/li>
&lt;li>ä¾¿äº GPU é«˜æ•ˆæ‰§è¡Œã€‚&lt;/li>
&lt;/ul>
&lt;h3 id="cuda-ä»£ç å®ç°">CUDA ä»£ç å®ç°
&lt;/h3>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-gdscript3" data-lang="gdscript3">&lt;span class="line">&lt;span class="cl">&lt;span class="o">//&lt;/span> &lt;span class="n">REDUCTION&lt;/span> &lt;span class="mi">0&lt;/span> &lt;span class="err">â€“&lt;/span> &lt;span class="n">Interleaved&lt;/span> &lt;span class="n">Addressing&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="n">__global__&lt;/span> &lt;span class="n">void&lt;/span> &lt;span class="n">reduce0&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="ne">int&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">g_in_data&lt;/span>&lt;span class="p">,&lt;/span> &lt;span class="ne">int&lt;/span> &lt;span class="o">*&lt;/span>&lt;span class="n">g_out_data&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">extern&lt;/span> &lt;span class="n">__shared__&lt;/span> &lt;span class="ne">int&lt;/span> &lt;span class="n">sdata&lt;/span>&lt;span class="p">[];&lt;/span> &lt;span class="o">//&lt;/span> &lt;span class="n">stored&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">the&lt;/span> &lt;span class="n">shared&lt;/span> &lt;span class="n">memory&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">Each&lt;/span> &lt;span class="n">thread&lt;/span> &lt;span class="n">loading&lt;/span> &lt;span class="n">one&lt;/span> &lt;span class="n">element&lt;/span> &lt;span class="n">from&lt;/span> &lt;span class="n">global&lt;/span> &lt;span class="n">onto&lt;/span> &lt;span class="n">shared&lt;/span> &lt;span class="n">memory&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">unsigned&lt;/span> &lt;span class="ne">int&lt;/span> &lt;span class="n">tid&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">threadIdx&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="o">//&lt;/span>&lt;span class="n">tidè¡¨ç¤ºå½“å‰çº¿ç¨‹åœ¨æ‰€åœ¨&lt;/span> &lt;span class="n">block&lt;/span> &lt;span class="err">ä¸­çš„å±€éƒ¨ç´¢å¼•&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">unsigned&lt;/span> &lt;span class="ne">int&lt;/span> &lt;span class="n">i&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">blockIdx&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">x&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">blockDim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">x&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">threadIdx&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">;&lt;/span>&lt;span class="o">//&lt;/span>&lt;span class="n">iè¡¨ç¤ºå½“å‰çº¿ç¨‹åœ¨æ•´ä¸ª&lt;/span> &lt;span class="n">grid&lt;/span> &lt;span class="err">ä¸­çš„å…¨å±€çº¿ç¨‹ç¼–å·&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sdata&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">tid&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">g_in_data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">i&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">__syncthreads&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="o">//&lt;/span> &lt;span class="n">Reduction&lt;/span> &lt;span class="n">method&lt;/span> &lt;span class="o">--&lt;/span> &lt;span class="n">occurs&lt;/span> &lt;span class="ow">in&lt;/span> &lt;span class="n">shared&lt;/span> &lt;span class="n">memory&lt;/span> &lt;span class="n">because&lt;/span> &lt;span class="n">that&lt;/span>&lt;span class="s1">&amp;#39;s where sdata is stored&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">for&lt;/span>&lt;span class="p">(&lt;/span>&lt;span class="n">unsigned&lt;/span> &lt;span class="ne">int&lt;/span> &lt;span class="n">s&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="mi">1&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">s&lt;/span> &lt;span class="o">&amp;lt;&lt;/span> &lt;span class="n">blockDim&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">;&lt;/span> &lt;span class="n">s&lt;/span> &lt;span class="o">*=&lt;/span> &lt;span class="mi">2&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">tid&lt;/span> &lt;span class="o">%&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="mi">2&lt;/span> &lt;span class="o">*&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">)&lt;/span> &lt;span class="p">{&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">sdata&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">tid&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">+=&lt;/span> &lt;span class="n">sdata&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">tid&lt;/span> &lt;span class="o">+&lt;/span> &lt;span class="n">s&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">__syncthreads&lt;/span>&lt;span class="p">();&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="k">if&lt;/span> &lt;span class="p">(&lt;/span>&lt;span class="n">tid&lt;/span> &lt;span class="o">==&lt;/span> &lt;span class="mi">0&lt;/span>&lt;span class="p">){&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="n">g_out_data&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="n">blockIdx&lt;/span>&lt;span class="o">.&lt;/span>&lt;span class="n">x&lt;/span>&lt;span class="p">]&lt;/span> &lt;span class="o">=&lt;/span> &lt;span class="n">sdata&lt;/span>&lt;span class="p">[&lt;/span>&lt;span class="mi">0&lt;/span>&lt;span class="p">];&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="p">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div>&lt;h3 id="è¯¥æ–¹æ³•å­˜åœ¨çš„é—®é¢˜">è¯¥æ–¹æ³•å­˜åœ¨çš„é—®é¢˜
&lt;/h3>&lt;p>è™½ç„¶è¿™ç§æ–¹æ³•æ˜¯å¹¶è¡Œç¼–ç¨‹çš„è‰¯å¥½åŸºç¡€ï¼Œä½†å®ƒä»å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æ€§èƒ½æŒ‡æ ‡ï¼Œåˆ†æä»£ç åœ¨è®¡ç®—å’Œå†…å­˜æ–¹é¢å¯èƒ½å­˜åœ¨çš„ä½æ•ˆä¹‹å¤„ã€‚&lt;/p>
&lt;p>&lt;strong>è®¡ç®—æ–¹é¢ï¼š&lt;/strong> ä¸€ä¸ªä¸»è¦çš„è®¡ç®—ä½æ•ˆæ˜¯ &lt;code>%&lt;/code> æ“ä½œç¬¦çš„ä½¿ç”¨ã€‚ç”±äº &lt;code>%&lt;/code> æ¶‰åŠé™¤æ³•æ“ä½œï¼Œè€Œé™¤æ³•åœ¨åº•å±‚æ˜¯éå¸¸æ…¢çš„æ“ä½œï¼Œè¿™ä¼šä¸¥é‡å½±å“æ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤§é‡çº¿ç¨‹é¢‘ç¹æ‰§è¡Œè¯¥æ“ä½œçš„å†…æ ¸ä¸­ã€‚æ­¤å¤–ï¼Œäº¤é”™å¯»å€æ¨¡å¼å¯¼è‡´äº†ä¸¥é‡çš„ warp å‘æ•£ï¼ˆdivergenceï¼‰ï¼Œå› ä¸ºåŒä¸€ä¸ª warp ä¸­çš„çº¿ç¨‹éœ€è¦æ‰§è¡Œä¸åŒçš„åˆ†æ”¯è·¯å¾„ï¼ˆåŸºäºå½“å‰çš„ &lt;code>if&lt;/code> æ¡ä»¶ï¼‰ã€‚è¿™ç§è·¯å¾„å‘æ•£å¯¼è‡´ warp éœ€è¦ç­‰å¾…è¾ƒæ…¢çš„çº¿ç¨‹å®Œæˆï¼Œé€ æˆé˜»å¡ï¼Œä»è€Œä¸¥é‡é™ä½æ€§èƒ½ã€‚å…·ä½“è€Œè¨€ï¼Œä»£ç å—ï¼š
ã€ã€ã€CUDA
for(unsigned int s = 1; s &amp;lt; blockDim.x; s *= 2){
if (tid % (2 * s) == 0) {
sdata[tid] += sdata[tid + s];&lt;br>
}
__syncthreads();
}
ã€ã€ã€
ç¬¬ä¸€ä¸ªforï¼Œæ¿€æ´»çš„çº¿ç¨‹ä¸º0ï¼Œ2ï¼Œ4&amp;hellip;ï¼›ç¬¬äºŒæ¬¡æ‰§è¡Œforå¾ªç¯ï¼Œæ¿€æ´»çš„çº¿ç¨‹ä¸º0ï¼Œ4ï¼Œ8&amp;hellip; æ˜¾ç„¶ï¼Œæ¯ä¸ªforå¾ªç¯ä¸­åªæœ‰æœ‰50%ï¼Œ25%ã€‚ã€‚ã€‚çš„çº¿ç¨‹å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œè¿™æ˜¾ç„¶æ˜¯æˆ‘ä»¬ä¸æƒ³çœ‹åˆ°äº†ã€‚æˆ‘ä»¬å¸Œæœ›å°½å¯èƒ½å¤šçš„çº¿ç¨‹éƒ½å¤„äºå·¥ä½œçŠ¶æ€ï¼Œè‡³å°‘åœ¨åŒä¸€ä¸ªwarpä¸­æ˜¯å¦‚æ­¤ã€‚&lt;/p>
&lt;p>&lt;strong>å†…å­˜æ–¹é¢ï¼š&lt;/strong> ç”±äº warp å‘æ•£ï¼Œè¯¥æ–¹æ³•çš„å†…å­˜è®¿é—®æ¨¡å¼ä¸ä½³ã€‚æ¯ä¸ªçº¿ç¨‹è®¿é—®çš„æ•°æ®å…ƒç´ åˆ†å¸ƒåœ¨æ•´ä¸ªæ•°ç»„ä¸­ï¼Œå¯¼è‡´å†…å­˜è®¿é—®åˆ†æ•£è€Œéåˆå¹¶è®¿é—®ï¼ˆcoalescedï¼‰ï¼Œä»è€Œé€ æˆå¸¦å®½åˆ©ç”¨ç‡ä½ä¸‹å’Œè¾ƒé«˜çš„å†…å­˜å»¶è¿Ÿã€‚è¿™ç§åˆ†æ•£è®¿é—®ä¼šå¼•èµ·å¤šæ¬¡ç¼“æ…¢çš„å†…å­˜äº‹åŠ¡ï¼Œè€Œéä¸€æ¬¡å¿«é€Ÿäº‹åŠ¡ï¼Œæœªèƒ½å……åˆ†åˆ©ç”¨ GPU çš„å†…å­˜å¸¦å®½èƒ½åŠ›ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªé—®é¢˜æˆ‘ä»¬ä¼šåœ¨åç»­çš„ä¼˜åŒ–ä¸­å¼€å§‹è§£å†³ã€‚å…·ä½“æ¥è¯´
è½®æ¬¡ 5: s = 16
if (tid % 32 == 0): åœ¨Warp 0 (çº¿ç¨‹0-31)ä¸­ï¼Œåªæœ‰çº¿ç¨‹0åœ¨å·¥ä½œã€‚
å®ƒè¯»å– sdata[16]ã€‚
è®¿å­˜åˆ†æ: æ•´ä¸ªWarpä¸ºäº†æ»¡è¶³çº¿ç¨‹0è¿™ä¸€ä¸ªè¯»å–è¯·æ±‚ï¼Œå‘èµ·äº†ä¸€æ¬¡å†…å­˜äº‹åŠ¡ã€‚ä½†è¿™æ¬¡äº‹åŠ¡ä¸­ï¼Œåªæœ‰1/32çš„æ•°æ®è¢«åˆ©ç”¨äº†ã€‚31/32çš„å†…å­˜å¸¦å®½è¢«æµªè´¹äº†ï¼&lt;/p>
&lt;p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆå…³æ³¨è®¡ç®—ç›¸å…³çš„é—®é¢˜ï¼Œå¹¶è¿›è¡Œä¸‹ä¸€æ­¥ä¼˜åŒ–ã€‚&lt;/p>
&lt;h2 id="reduce-1äº¤é”™å¯»å€æ³•-20interleaved-addressing-20">REDUCE-1ï¼šäº¤é”™å¯»å€æ³• 2.0ï¼ˆInterleaved Addressing 2.0ï¼‰
&lt;/h2>&lt;div class="highlight">&lt;div class="chroma">
&lt;table class="lntable">&lt;tr>&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code>&lt;span class="lnt"> 1
&lt;/span>&lt;span class="lnt"> 2
&lt;/span>&lt;span class="lnt"> 3
&lt;/span>&lt;span class="lnt"> 4
&lt;/span>&lt;span class="lnt"> 5
&lt;/span>&lt;span class="lnt"> 6
&lt;/span>&lt;span class="lnt"> 7
&lt;/span>&lt;span class="lnt"> 8
&lt;/span>&lt;span class="lnt"> 9
&lt;/span>&lt;span class="lnt">10
&lt;/span>&lt;span class="lnt">11
&lt;/span>&lt;span class="lnt">12
&lt;/span>&lt;span class="lnt">13
&lt;/span>&lt;span class="lnt">14
&lt;/span>&lt;span class="lnt">15
&lt;/span>&lt;span class="lnt">16
&lt;/span>&lt;span class="lnt">17
&lt;/span>&lt;span class="lnt">18
&lt;/span>&lt;span class="lnt">19
&lt;/span>&lt;span class="lnt">20
&lt;/span>&lt;span class="lnt">21
&lt;/span>&lt;span class="lnt">22
&lt;/span>&lt;span class="lnt">23
&lt;/span>&lt;span class="lnt">24
&lt;/span>&lt;span class="lnt">25
&lt;/span>&lt;span class="lnt">26
&lt;/span>&lt;span class="lnt">27
&lt;/span>&lt;span class="lnt">28
&lt;/span>&lt;/code>&lt;/pre>&lt;/td>
&lt;td class="lntd">
&lt;pre tabindex="0" class="chroma">&lt;code class="language-fallback" data-lang="fallback">&lt;span class="line">&lt;span class="cl">// REDUCTION 1 â€“ Interleaved Addressing 2.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">__global__ void reduce1(int *g_in_data, int *g_out_data){
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> extern __shared__ int sdata[]; // å‚¨å­˜åœ¨å…±äº«å†…å­˜ä¸­
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ¯ä¸ªçº¿ç¨‹ä»å…¨å±€å†…å­˜åŠ è½½ä¸€ä¸ªå…ƒç´ åˆ°å…±äº«å†…å­˜
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> unsigned int tid = threadIdx.x;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> unsigned int i = blockIdx.x * blockDim.x + threadIdx.x;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sdata[tid] = g_in_data[i];
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> __syncthreads();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // å½’çº¦æ“ä½œ -- åœ¨å…±äº«å†…å­˜ä¸­è¿›è¡Œ
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> for(unsigned int s = 1; s &amp;lt; blockDim.x; s *= 2){
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // æ³¨æ„æ­¥é•¿ s *= 2ï¼šè¿™å¯¼è‡´äº†äº¤é”™å¯»å€
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> int index = 2 * s * tid; // ç°åœ¨æˆ‘ä»¬ä¸å†éœ€è¦ if æ¡ä»¶å¸¦æ¥çš„åˆ†åŒ–åˆ†æ”¯
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // ç¡®ä¿ä¸ä¼šè¶Šç•Œè®¿é—®
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (index &amp;lt; blockDim.x)
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> {
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> sdata[index] += sdata[index + s]; // s ç”¨æ¥è¡¨ç¤ºå°†è¢«åˆå¹¶çš„åç§»é‡
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> __syncthreads();
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> // çº¿ç¨‹0å°†æœ€ç»ˆç»“æœå†™å›å…¨å±€å†…å­˜
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> if (tid == 0){
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> g_out_data[blockIdx.x] = sdata[0];
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> }
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">}
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/td>&lt;/tr>&lt;/table>
&lt;/div>
&lt;/div></description></item></channel></rss>
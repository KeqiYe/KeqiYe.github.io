<!doctype html><html lang=zh-cn dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="åŸºäºç¨ å¯†å­˜å‚¨çš„å¹¶è¡Œæ ‘æ„å»ºå®ç°æ–¹æ¡ˆ å¼•è¨€ åœ¨ç©ºé—´åˆ’åˆ†ä¸é‚»åŸŸæœç´¢ç­‰ç®—æ³•ä¸­ï¼Œæ ‘å½¢æ•°æ®ç»“æ„ï¼ˆå¦‚å…«å‰æ ‘ã€å››å‰æ ‘ã€Barnes-Hut æ ‘ï¼‰æ˜¯é«˜æ•ˆçš„åŠ é€Ÿæ‰‹æ®µã€‚ æ„å»ºè¿™ç±»æ ‘ç»“æ„æ—¶ï¼Œå­˜å‚¨æ–¹å¼æ˜¯å½±å“æ€§èƒ½ä¸å†…å­˜æ•ˆç‡çš„å…³é”®å› ç´ ä¹‹ä¸€ã€‚ å¸¸è§çš„å­˜å‚¨æ–¹å¼æœ‰ä¸¤ç§ï¼š ç¨€ç–å­˜å‚¨ï¼ˆSparse Storageï¼‰ï¼šä¸ºæ¯ä¸ªèŠ‚ç‚¹é¢„ç•™è¾ƒå¤§ç´¢å¼•ç©ºé—´ï¼ŒæŒ‰éœ€å¡«å……ï¼Œæ˜“å®ç°ï¼Œä½†ä¼šæµªè´¹å†…å­˜ã€‚ ç¨ å¯†å­˜å‚¨ï¼ˆDense Storageï¼‰ï¼šèŠ‚ç‚¹å­˜å‚¨åœ¨è¿ç»­æ•°ç»„ä¸­ï¼ŒæŒ‰ç…§æ„å»ºé¡ºåºç´§å¯†æ’åˆ—ï¼ŒèŠ‚çœå†…å­˜ï¼Œä½†éœ€è¦é¢å¤–çš„ç®¡ç†é€»è¾‘ã€‚ ä½ ä¹‹å‰çš„å®ç°é‡‡ç”¨äº†ç¨€ç–å­˜å‚¨ï¼Œåœ¨é«˜ç²’å­æ•°æ—¶å†…å­˜å ç”¨æ˜æ˜¾å¢åŠ ã€‚ æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åŸºäºç¨ å¯†å­˜å‚¨å®ç°é«˜æ•ˆçš„æ ‘æ„å»ºï¼Œå¹¶ç»™å‡º CUDA å¹¶è¡Œç‰ˆæœ¬çš„å®ç°æ€è·¯ã€‚ ç¨ å¯†å­˜å‚¨çš„åŸºæœ¬æ€æƒ³ ç¨ å¯†å­˜å‚¨çš„ç›®æ ‡æ˜¯ï¼š èŠ‚ç‚¹æ•°ç»„ç´§å‡‘å­˜æ”¾ï¼Œä¸ç•™å¤§å—æœªä½¿ç”¨ç©ºé—´ èŠ‚ç‚¹ç´¢å¼•ç›´æ¥æ˜ å°„åˆ°æ•°ç»„ä¸‹æ ‡ åœ¨æ’å…¥æ–°èŠ‚ç‚¹æ—¶ï¼Œé€šè¿‡ä¸€ä¸ªå…¨å±€ maxNodeIndex é€’å‡åˆ†é…æ–°ä½ç½® è¿™ç§æ–¹æ³•ç±»ä¼¼â€œå€’ç€åˆ†é…â€èŠ‚ç‚¹ç©ºé—´ï¼š 1 [ç²’å­0] [ç²’å­1] ... [ç²’å­N-1] [å†…éƒ¨èŠ‚ç‚¹M] [å†…éƒ¨èŠ‚ç‚¹M-1] ... å…¶ä¸­ï¼š 0 ~ numParticles-1 åŒºé—´å­˜æ”¾å¶å­èŠ‚ç‚¹ï¼ˆç²’å­ï¼‰ numParticles ~ maxNodeIndex-1 åŒºé—´å­˜æ”¾å†…éƒ¨èŠ‚ç‚¹ æ•°æ®ç»“æ„è®¾è®¡ åœ¨ç¨ å¯†å­˜å‚¨ä¸­ï¼Œæ ¸å¿ƒæ•°æ®ç»“æ„é€šå¸¸åŒ…æ‹¬ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // ç²’å­æ•°æ® struct Particles { double *x, *y, *z; // åæ ‡ double *m; // è´¨é‡ double *ax, *ay, *az; // åŠ é€Ÿåº¦ int *depth; // æ ‘æ·±åº¦ }; // æ ‘èŠ‚ç‚¹ä¿¡æ¯ struct Tree { volatile double *x, *y, *z; // èŠ‚ç‚¹ä¸­å¿ƒ volatile double *m; // èŠ‚ç‚¹åŠå¾„ï¼ˆæˆ–è´¨é‡ç­‰ï¼‰ int *childList; // å­˜å‚¨å­èŠ‚ç‚¹ç´¢å¼• int maxNodeIndex; // å½“å‰å¯åˆ†é…çš„æœ€å¤§ç´¢å¼•ï¼ˆé€’å‡ï¼‰ }; å…³é”®ç‚¹ï¼šchildList æ˜¯ä¸€ç»´æ•°ç»„ï¼Œé€šè¿‡ childListIndex(nodeIndex, childSlot) æ˜ å°„åˆ°èŠ‚ç‚¹çš„ç¬¬å‡ ä¸ªå­èŠ‚ç‚¹ä½ç½®ã€‚è¿™æ ·å­˜å‚¨æ–¹å¼å¤©ç„¶ç´§å‡‘ã€‚"><title>åŸºäºç¨ å¯†å­˜å‚¨çš„å¹¶è¡Œæ ‘æ„å»ºå®ç°æ–¹æ¡ˆ</title>
<link rel=canonical href=https://keqiye.github.io/zh-cn/posts/dense-tree-build/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="åŸºäºç¨ å¯†å­˜å‚¨çš„å¹¶è¡Œæ ‘æ„å»ºå®ç°æ–¹æ¡ˆ"><meta property='og:description' content="åŸºäºç¨ å¯†å­˜å‚¨çš„å¹¶è¡Œæ ‘æ„å»ºå®ç°æ–¹æ¡ˆ å¼•è¨€ åœ¨ç©ºé—´åˆ’åˆ†ä¸é‚»åŸŸæœç´¢ç­‰ç®—æ³•ä¸­ï¼Œæ ‘å½¢æ•°æ®ç»“æ„ï¼ˆå¦‚å…«å‰æ ‘ã€å››å‰æ ‘ã€Barnes-Hut æ ‘ï¼‰æ˜¯é«˜æ•ˆçš„åŠ é€Ÿæ‰‹æ®µã€‚ æ„å»ºè¿™ç±»æ ‘ç»“æ„æ—¶ï¼Œå­˜å‚¨æ–¹å¼æ˜¯å½±å“æ€§èƒ½ä¸å†…å­˜æ•ˆç‡çš„å…³é”®å› ç´ ä¹‹ä¸€ã€‚ å¸¸è§çš„å­˜å‚¨æ–¹å¼æœ‰ä¸¤ç§ï¼š ç¨€ç–å­˜å‚¨ï¼ˆSparse Storageï¼‰ï¼šä¸ºæ¯ä¸ªèŠ‚ç‚¹é¢„ç•™è¾ƒå¤§ç´¢å¼•ç©ºé—´ï¼ŒæŒ‰éœ€å¡«å……ï¼Œæ˜“å®ç°ï¼Œä½†ä¼šæµªè´¹å†…å­˜ã€‚ ç¨ å¯†å­˜å‚¨ï¼ˆDense Storageï¼‰ï¼šèŠ‚ç‚¹å­˜å‚¨åœ¨è¿ç»­æ•°ç»„ä¸­ï¼ŒæŒ‰ç…§æ„å»ºé¡ºåºç´§å¯†æ’åˆ—ï¼ŒèŠ‚çœå†…å­˜ï¼Œä½†éœ€è¦é¢å¤–çš„ç®¡ç†é€»è¾‘ã€‚ ä½ ä¹‹å‰çš„å®ç°é‡‡ç”¨äº†ç¨€ç–å­˜å‚¨ï¼Œåœ¨é«˜ç²’å­æ•°æ—¶å†…å­˜å ç”¨æ˜æ˜¾å¢åŠ ã€‚ æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åŸºäºç¨ å¯†å­˜å‚¨å®ç°é«˜æ•ˆçš„æ ‘æ„å»ºï¼Œå¹¶ç»™å‡º CUDA å¹¶è¡Œç‰ˆæœ¬çš„å®ç°æ€è·¯ã€‚ ç¨ å¯†å­˜å‚¨çš„åŸºæœ¬æ€æƒ³ ç¨ å¯†å­˜å‚¨çš„ç›®æ ‡æ˜¯ï¼š èŠ‚ç‚¹æ•°ç»„ç´§å‡‘å­˜æ”¾ï¼Œä¸ç•™å¤§å—æœªä½¿ç”¨ç©ºé—´ èŠ‚ç‚¹ç´¢å¼•ç›´æ¥æ˜ å°„åˆ°æ•°ç»„ä¸‹æ ‡ åœ¨æ’å…¥æ–°èŠ‚ç‚¹æ—¶ï¼Œé€šè¿‡ä¸€ä¸ªå…¨å±€ maxNodeIndex é€’å‡åˆ†é…æ–°ä½ç½® è¿™ç§æ–¹æ³•ç±»ä¼¼â€œå€’ç€åˆ†é…â€èŠ‚ç‚¹ç©ºé—´ï¼š 1 [ç²’å­0] [ç²’å­1] ... [ç²’å­N-1] [å†…éƒ¨èŠ‚ç‚¹M] [å†…éƒ¨èŠ‚ç‚¹M-1] ... å…¶ä¸­ï¼š 0 ~ numParticles-1 åŒºé—´å­˜æ”¾å¶å­èŠ‚ç‚¹ï¼ˆç²’å­ï¼‰ numParticles ~ maxNodeIndex-1 åŒºé—´å­˜æ”¾å†…éƒ¨èŠ‚ç‚¹ æ•°æ®ç»“æ„è®¾è®¡ åœ¨ç¨ å¯†å­˜å‚¨ä¸­ï¼Œæ ¸å¿ƒæ•°æ®ç»“æ„é€šå¸¸åŒ…æ‹¬ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // ç²’å­æ•°æ® struct Particles { double *x, *y, *z; // åæ ‡ double *m; // è´¨é‡ double *ax, *ay, *az; // åŠ é€Ÿåº¦ int *depth; // æ ‘æ·±åº¦ }; // æ ‘èŠ‚ç‚¹ä¿¡æ¯ struct Tree { volatile double *x, *y, *z; // èŠ‚ç‚¹ä¸­å¿ƒ volatile double *m; // èŠ‚ç‚¹åŠå¾„ï¼ˆæˆ–è´¨é‡ç­‰ï¼‰ int *childList; // å­˜å‚¨å­èŠ‚ç‚¹ç´¢å¼• int maxNodeIndex; // å½“å‰å¯åˆ†é…çš„æœ€å¤§ç´¢å¼•ï¼ˆé€’å‡ï¼‰ }; å…³é”®ç‚¹ï¼šchildList æ˜¯ä¸€ç»´æ•°ç»„ï¼Œé€šè¿‡ childListIndex(nodeIndex, childSlot) æ˜ å°„åˆ°èŠ‚ç‚¹çš„ç¬¬å‡ ä¸ªå­èŠ‚ç‚¹ä½ç½®ã€‚è¿™æ ·å­˜å‚¨æ–¹å¼å¤©ç„¶ç´§å‡‘ã€‚"><meta property='og:url' content='https://keqiye.github.io/zh-cn/posts/dense-tree-build/'><meta property='og:site_name' content='Keqiçš„åšå®¢'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:published_time' content='2025-08-15T00:00:00+00:00'><meta property='article:modified_time' content='2025-08-15T00:00:00+00:00'><meta name=twitter:title content="åŸºäºç¨ å¯†å­˜å‚¨çš„å¹¶è¡Œæ ‘æ„å»ºå®ç°æ–¹æ¡ˆ"><meta name=twitter:description content="åŸºäºç¨ å¯†å­˜å‚¨çš„å¹¶è¡Œæ ‘æ„å»ºå®ç°æ–¹æ¡ˆ å¼•è¨€ åœ¨ç©ºé—´åˆ’åˆ†ä¸é‚»åŸŸæœç´¢ç­‰ç®—æ³•ä¸­ï¼Œæ ‘å½¢æ•°æ®ç»“æ„ï¼ˆå¦‚å…«å‰æ ‘ã€å››å‰æ ‘ã€Barnes-Hut æ ‘ï¼‰æ˜¯é«˜æ•ˆçš„åŠ é€Ÿæ‰‹æ®µã€‚ æ„å»ºè¿™ç±»æ ‘ç»“æ„æ—¶ï¼Œå­˜å‚¨æ–¹å¼æ˜¯å½±å“æ€§èƒ½ä¸å†…å­˜æ•ˆç‡çš„å…³é”®å› ç´ ä¹‹ä¸€ã€‚ å¸¸è§çš„å­˜å‚¨æ–¹å¼æœ‰ä¸¤ç§ï¼š ç¨€ç–å­˜å‚¨ï¼ˆSparse Storageï¼‰ï¼šä¸ºæ¯ä¸ªèŠ‚ç‚¹é¢„ç•™è¾ƒå¤§ç´¢å¼•ç©ºé—´ï¼ŒæŒ‰éœ€å¡«å……ï¼Œæ˜“å®ç°ï¼Œä½†ä¼šæµªè´¹å†…å­˜ã€‚ ç¨ å¯†å­˜å‚¨ï¼ˆDense Storageï¼‰ï¼šèŠ‚ç‚¹å­˜å‚¨åœ¨è¿ç»­æ•°ç»„ä¸­ï¼ŒæŒ‰ç…§æ„å»ºé¡ºåºç´§å¯†æ’åˆ—ï¼ŒèŠ‚çœå†…å­˜ï¼Œä½†éœ€è¦é¢å¤–çš„ç®¡ç†é€»è¾‘ã€‚ ä½ ä¹‹å‰çš„å®ç°é‡‡ç”¨äº†ç¨€ç–å­˜å‚¨ï¼Œåœ¨é«˜ç²’å­æ•°æ—¶å†…å­˜å ç”¨æ˜æ˜¾å¢åŠ ã€‚ æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åŸºäºç¨ å¯†å­˜å‚¨å®ç°é«˜æ•ˆçš„æ ‘æ„å»ºï¼Œå¹¶ç»™å‡º CUDA å¹¶è¡Œç‰ˆæœ¬çš„å®ç°æ€è·¯ã€‚ ç¨ å¯†å­˜å‚¨çš„åŸºæœ¬æ€æƒ³ ç¨ å¯†å­˜å‚¨çš„ç›®æ ‡æ˜¯ï¼š èŠ‚ç‚¹æ•°ç»„ç´§å‡‘å­˜æ”¾ï¼Œä¸ç•™å¤§å—æœªä½¿ç”¨ç©ºé—´ èŠ‚ç‚¹ç´¢å¼•ç›´æ¥æ˜ å°„åˆ°æ•°ç»„ä¸‹æ ‡ åœ¨æ’å…¥æ–°èŠ‚ç‚¹æ—¶ï¼Œé€šè¿‡ä¸€ä¸ªå…¨å±€ maxNodeIndex é€’å‡åˆ†é…æ–°ä½ç½® è¿™ç§æ–¹æ³•ç±»ä¼¼â€œå€’ç€åˆ†é…â€èŠ‚ç‚¹ç©ºé—´ï¼š 1 [ç²’å­0] [ç²’å­1] ... [ç²’å­N-1] [å†…éƒ¨èŠ‚ç‚¹M] [å†…éƒ¨èŠ‚ç‚¹M-1] ... å…¶ä¸­ï¼š 0 ~ numParticles-1 åŒºé—´å­˜æ”¾å¶å­èŠ‚ç‚¹ï¼ˆç²’å­ï¼‰ numParticles ~ maxNodeIndex-1 åŒºé—´å­˜æ”¾å†…éƒ¨èŠ‚ç‚¹ æ•°æ®ç»“æ„è®¾è®¡ åœ¨ç¨ å¯†å­˜å‚¨ä¸­ï¼Œæ ¸å¿ƒæ•°æ®ç»“æ„é€šå¸¸åŒ…æ‹¬ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // ç²’å­æ•°æ® struct Particles { double *x, *y, *z; // åæ ‡ double *m; // è´¨é‡ double *ax, *ay, *az; // åŠ é€Ÿåº¦ int *depth; // æ ‘æ·±åº¦ }; // æ ‘èŠ‚ç‚¹ä¿¡æ¯ struct Tree { volatile double *x, *y, *z; // èŠ‚ç‚¹ä¸­å¿ƒ volatile double *m; // èŠ‚ç‚¹åŠå¾„ï¼ˆæˆ–è´¨é‡ç­‰ï¼‰ int *childList; // å­˜å‚¨å­èŠ‚ç‚¹ç´¢å¼• int maxNodeIndex; // å½“å‰å¯åˆ†é…çš„æœ€å¤§ç´¢å¼•ï¼ˆé€’å‡ï¼‰ }; å…³é”®ç‚¹ï¼šchildList æ˜¯ä¸€ç»´æ•°ç»„ï¼Œé€šè¿‡ childListIndex(nodeIndex, childSlot) æ˜ å°„åˆ°èŠ‚ç‚¹çš„ç¬¬å‡ ä¸ªå­èŠ‚ç‚¹ä½ç½®ã€‚è¿™æ ·å­˜å‚¨æ–¹å¼å¤©ç„¶ç´§å‡‘ã€‚"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=åˆ‡æ¢èœå•>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/zh-cn/><img src="https://avatars.githubusercontent.com/u/175122082?v=4" width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ğŸª</span></figure><div class=site-meta><h1 class=site-name><a href=/zh-cn>Keqiçš„åšå®¢</a></h1><h2 class=site-description>æ•°å­¦ã€ç‰©ç†ä¸ç¼–ç¨‹</h2></div></header><ol class=menu-social><li><a href=plloningye@gmail.com target=_blank title=E-mail rel=me><svg data-name="Livello 1" id="Livello_1" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg"><title/><path d="M116.73 31.83a3 3 0 00-4.2-.61L64.14 67.34a1 1 0 01-1.2.0L15.5 31.06a3 3 0 10-3.64 4.77l37.3 28.53-36.89 27.8A3 3 0 1015.88 97L54.11 68.14l5.18 4a7 7 0 008.43.06l5.44-4.06L111.84 97a3 3 0 103.59-4.81L78.17 64.35 116.12 36A3 3 0 00116.73 31.83z"/><path d="M113 19H15A15 15 0 000 34V94a15 15 0 0015 15h98a15 15 0 0015-15V34A15 15 0 00113 19zm9 75a9 9 0 01-9 9H15a9 9 0 01-9-9V34a9 9 0 019-9h98a9 9 0 019 9z"/></svg></a></li><li><a href=https://github.com/KeqiYe target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li class=menu-bottom-section><ol class=menu><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language title=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://keqiye.github.io/>English</option><option value=https://keqiye.github.io/zh-cn/ selected>ä¸­æ–‡</option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>æš—è‰²æ¨¡å¼</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">ç›®å½•</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#å¼•è¨€>å¼•è¨€</a></li><li><a href=#ç¨ å¯†å­˜å‚¨çš„åŸºæœ¬æ€æƒ³>ç¨ å¯†å­˜å‚¨çš„åŸºæœ¬æ€æƒ³</a></li><li><a href=#æ•°æ®ç»“æ„è®¾è®¡>æ•°æ®ç»“æ„è®¾è®¡</a></li><li><a href=#æ„å»ºæµç¨‹è¯¦è§£>æ„å»ºæµç¨‹è¯¦è§£</a></li><li><a href=#æ ¸å¿ƒä»£ç ç‰‡æ®µ>æ ¸å¿ƒä»£ç ç‰‡æ®µ</a></li><li><a href=#å¹¶å‘ä¸åŒæ­¥>å¹¶å‘ä¸åŒæ­¥</a></li><li><a href=#æ€§èƒ½åˆ†æä¸ä¼˜åŒ–å»ºè®®>æ€§èƒ½åˆ†æä¸ä¼˜åŒ–å»ºè®®</a></li><li><a href=#æ€»ç»“ä¸åº”ç”¨åœºæ™¯>æ€»ç»“ä¸åº”ç”¨åœºæ™¯</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/zh-cn/categories/%E5%B9%B6%E8%A1%8C%E8%AE%A1%E7%AE%97/>å¹¶è¡Œè®¡ç®—
</a><a href=/zh-cn/categories/%E6%A0%91%E7%BB%93%E6%9E%84/>æ ‘ç»“æ„
</a><a href=/zh-cn/categories/cuda/>CUDA</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/zh-cn/posts/dense-tree-build/>åŸºäºç¨ å¯†å­˜å‚¨çš„å¹¶è¡Œæ ‘æ„å»ºå®ç°æ–¹æ¡ˆ</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Aug 15, 2025</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>é˜…è¯»æ—¶é•¿: 2 åˆ†é’Ÿ</time></div></footer></div></header><section class=article-content><h1 id=åŸºäºç¨ å¯†å­˜å‚¨çš„å¹¶è¡Œæ ‘æ„å»ºå®ç°æ–¹æ¡ˆ>åŸºäºç¨ å¯†å­˜å‚¨çš„å¹¶è¡Œæ ‘æ„å»ºå®ç°æ–¹æ¡ˆ</h1><h2 id=å¼•è¨€>å¼•è¨€</h2><p>åœ¨ç©ºé—´åˆ’åˆ†ä¸é‚»åŸŸæœç´¢ç­‰ç®—æ³•ä¸­ï¼Œæ ‘å½¢æ•°æ®ç»“æ„ï¼ˆå¦‚å…«å‰æ ‘ã€å››å‰æ ‘ã€Barnes-Hut æ ‘ï¼‰æ˜¯é«˜æ•ˆçš„åŠ é€Ÿæ‰‹æ®µã€‚<br>æ„å»ºè¿™ç±»æ ‘ç»“æ„æ—¶ï¼Œ<strong>å­˜å‚¨æ–¹å¼</strong>æ˜¯å½±å“æ€§èƒ½ä¸å†…å­˜æ•ˆç‡çš„å…³é”®å› ç´ ä¹‹ä¸€ã€‚<br>å¸¸è§çš„å­˜å‚¨æ–¹å¼æœ‰ä¸¤ç§ï¼š</p><ul><li><strong>ç¨€ç–å­˜å‚¨ï¼ˆSparse Storageï¼‰</strong>ï¼šä¸ºæ¯ä¸ªèŠ‚ç‚¹é¢„ç•™è¾ƒå¤§ç´¢å¼•ç©ºé—´ï¼ŒæŒ‰éœ€å¡«å……ï¼Œæ˜“å®ç°ï¼Œä½†ä¼šæµªè´¹å†…å­˜ã€‚</li><li><strong>ç¨ å¯†å­˜å‚¨ï¼ˆDense Storageï¼‰</strong>ï¼šèŠ‚ç‚¹å­˜å‚¨åœ¨è¿ç»­æ•°ç»„ä¸­ï¼ŒæŒ‰ç…§æ„å»ºé¡ºåºç´§å¯†æ’åˆ—ï¼ŒèŠ‚çœå†…å­˜ï¼Œä½†éœ€è¦é¢å¤–çš„ç®¡ç†é€»è¾‘ã€‚</li></ul><p>ä½ ä¹‹å‰çš„å®ç°é‡‡ç”¨äº†ç¨€ç–å­˜å‚¨ï¼Œåœ¨é«˜ç²’å­æ•°æ—¶å†…å­˜å ç”¨æ˜æ˜¾å¢åŠ ã€‚<br>æœ¬æ–‡å°†ä»‹ç»å¦‚ä½•åŸºäºç¨ å¯†å­˜å‚¨å®ç°é«˜æ•ˆçš„æ ‘æ„å»ºï¼Œå¹¶ç»™å‡º CUDA å¹¶è¡Œç‰ˆæœ¬çš„å®ç°æ€è·¯ã€‚</p><hr><h2 id=ç¨ å¯†å­˜å‚¨çš„åŸºæœ¬æ€æƒ³>ç¨ å¯†å­˜å‚¨çš„åŸºæœ¬æ€æƒ³</h2><p>ç¨ å¯†å­˜å‚¨çš„ç›®æ ‡æ˜¯ï¼š</p><ul><li>èŠ‚ç‚¹æ•°ç»„ç´§å‡‘å­˜æ”¾ï¼Œä¸ç•™å¤§å—æœªä½¿ç”¨ç©ºé—´</li><li>èŠ‚ç‚¹ç´¢å¼•ç›´æ¥æ˜ å°„åˆ°æ•°ç»„ä¸‹æ ‡</li><li>åœ¨æ’å…¥æ–°èŠ‚ç‚¹æ—¶ï¼Œé€šè¿‡ä¸€ä¸ªå…¨å±€ <strong>maxNodeIndex</strong> é€’å‡åˆ†é…æ–°ä½ç½®</li></ul><p>è¿™ç§æ–¹æ³•ç±»ä¼¼â€œå€’ç€åˆ†é…â€èŠ‚ç‚¹ç©ºé—´ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>[ç²’å­0] [ç²’å­1] ... [ç²’å­N-1] [å†…éƒ¨èŠ‚ç‚¹M] [å†…éƒ¨èŠ‚ç‚¹M-1] ...
</span></span></code></pre></td></tr></table></div></div><p>å…¶ä¸­ï¼š</p><ul><li><strong>0 ~ numParticles-1</strong> åŒºé—´å­˜æ”¾å¶å­èŠ‚ç‚¹ï¼ˆç²’å­ï¼‰</li><li><strong>numParticles ~ maxNodeIndex-1</strong> åŒºé—´å­˜æ”¾å†…éƒ¨èŠ‚ç‚¹</li></ul><hr><h2 id=æ•°æ®ç»“æ„è®¾è®¡>æ•°æ®ç»“æ„è®¾è®¡</h2><p>åœ¨ç¨ å¯†å­˜å‚¨ä¸­ï¼Œæ ¸å¿ƒæ•°æ®ç»“æ„é€šå¸¸åŒ…æ‹¬ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=c1>// ç²’å­æ•°æ®
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>struct</span> <span class=nc>Particles</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>double</span> <span class=o>*</span><span class=n>x</span><span class=p>,</span> <span class=o>*</span><span class=n>y</span><span class=p>,</span> <span class=o>*</span><span class=n>z</span><span class=p>;</span> <span class=c1>// åæ ‡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>double</span> <span class=o>*</span><span class=n>m</span><span class=p>;</span>         <span class=c1>// è´¨é‡
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>double</span> <span class=o>*</span><span class=n>ax</span><span class=p>,</span> <span class=o>*</span><span class=n>ay</span><span class=p>,</span> <span class=o>*</span><span class=n>az</span><span class=p>;</span> <span class=c1>// åŠ é€Ÿåº¦
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=o>*</span><span class=n>depth</span><span class=p>;</span>        <span class=c1>// æ ‘æ·±åº¦
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// æ ‘èŠ‚ç‚¹ä¿¡æ¯
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>struct</span> <span class=nc>Tree</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>volatile</span> <span class=kt>double</span> <span class=o>*</span><span class=n>x</span><span class=p>,</span> <span class=o>*</span><span class=n>y</span><span class=p>,</span> <span class=o>*</span><span class=n>z</span><span class=p>;</span> <span class=c1>// èŠ‚ç‚¹ä¸­å¿ƒ
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>volatile</span> <span class=kt>double</span> <span class=o>*</span><span class=n>m</span><span class=p>;</span>         <span class=c1>// èŠ‚ç‚¹åŠå¾„ï¼ˆæˆ–è´¨é‡ç­‰ï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=o>*</span><span class=n>childList</span><span class=p>;</span>             <span class=c1>// å­˜å‚¨å­èŠ‚ç‚¹ç´¢å¼•
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=kt>int</span> <span class=n>maxNodeIndex</span><span class=p>;</span>           <span class=c1>// å½“å‰å¯åˆ†é…çš„æœ€å¤§ç´¢å¼•ï¼ˆé€’å‡ï¼‰
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><p><strong>å…³é”®ç‚¹</strong>ï¼š<code>childList</code> æ˜¯ä¸€ç»´æ•°ç»„ï¼Œé€šè¿‡ <code>childListIndex(nodeIndex, childSlot)</code> æ˜ å°„åˆ°èŠ‚ç‚¹çš„ç¬¬å‡ ä¸ªå­èŠ‚ç‚¹ä½ç½®ã€‚è¿™æ ·å­˜å‚¨æ–¹å¼å¤©ç„¶ç´§å‡‘ã€‚</p><hr><h2 id=æ„å»ºæµç¨‹è¯¦è§£>æ„å»ºæµç¨‹è¯¦è§£</h2><p>ç¨ å¯†å­˜å‚¨çš„æ„å»ºé€»è¾‘å¦‚ä¸‹ï¼š</p><ol><li><p><strong>åˆå§‹åŒ–æ ¹èŠ‚ç‚¹</strong></p><ul><li>æ ¹èŠ‚ç‚¹ç´¢å¼•ä¸º <code>numNodes-1</code>ï¼ˆæ•°ç»„æœ«å°¾ï¼‰</li><li>ä¿å­˜ä¸­å¿ƒåæ ‡å’ŒåŠå¾„</li></ul></li><li><p><strong>éå†ç²’å­</strong>ï¼ˆå¹¶è¡Œï¼‰</p><ul><li>æ¯ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªç²’å­ï¼Œæ­¥é•¿ä¸º <code>blockDim.x * gridDim.x</code></li><li>ç¼“å­˜ç²’å­åæ ‡ï¼ŒåŠ é€Ÿæ¯”è¾ƒ</li></ul></li><li><p><strong>ä¸‹è¡ŒæŸ¥æ‰¾æ’å…¥ä½ç½®</strong></p><ul><li>ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œåˆ¤æ–­ç²’å­å±äºå“ªä¸ªå­è±¡é™ï¼ˆå…«å‰æ ‘ä¸­ 0~7ï¼‰</li><li>å¦‚æœå­èŠ‚ç‚¹æ˜¯å†…éƒ¨èŠ‚ç‚¹ï¼Œç»§ç»­ä¸‹è¡Œ</li><li>å¦‚æœå­èŠ‚ç‚¹æ˜¯ç©ºçš„ï¼Œç›´æ¥æ’å…¥ç²’å­</li><li>å¦‚æœå­èŠ‚ç‚¹æ˜¯å¦ä¸€ä¸ªç²’å­ï¼Œåˆ›å»ºæ–°çš„å†…éƒ¨èŠ‚ç‚¹</li></ul></li><li><p><strong>åˆ›å»ºæ–°å†…éƒ¨èŠ‚ç‚¹</strong></p><ul><li>ä½¿ç”¨ <code>atomicSub</code> ä» <code>maxNodeIndex</code> åˆ†é…æ–°çš„èŠ‚ç‚¹ç´¢å¼•</li><li>è®¡ç®—æ–°èŠ‚ç‚¹çš„ä¸­å¿ƒå’ŒåŠå¾„</li><li>å°†å·²æœ‰ç²’å­ä¸æ–°ç²’å­åˆ†åˆ«æ’å…¥åˆ°ä¸åŒçš„å­æ§½ä¸­</li><li>å¦‚æœä¸¤è€…ä»è½åœ¨åŒä¸€ä¸ªæ§½å†…ï¼Œç»§ç»­ç»†åˆ†</li></ul></li><li><p><strong>è§£é”ä¸åŒæ­¥</strong></p><ul><li>é€šè¿‡ <code>atomicCAS</code> å®ç°æ’å…¥ä½ç½®çš„åŸå­é”å®š</li><li>ä½¿ç”¨ <code>__threadfence()</code> ç¡®ä¿å†…å­˜å¯è§æ€§</li></ul></li></ol><hr><h2 id=æ ¸å¿ƒä»£ç ç‰‡æ®µ>æ ¸å¿ƒä»£ç ç‰‡æ®µ</h2><p>ä¸‹é¢æ˜¯ç®€åŒ–ç‰ˆçš„ç¨ å¯†å­˜å‚¨èŠ‚ç‚¹åˆ†é…é€»è¾‘ï¼š</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cpp data-lang=cpp><span class=line><span class=cl><span class=k>if</span> <span class=p>(</span><span class=n>child</span> <span class=o>==</span> <span class=n>atomicCAS</span><span class=p>(</span><span class=o>&amp;</span><span class=n>childList</span><span class=p>[</span><span class=n>lockedIndex</span><span class=p>],</span> <span class=n>child</span><span class=p>,</span> <span class=n>LOCKED</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>child</span> <span class=o>==</span> <span class=n>EMPTY</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>childList</span><span class=p>[</span><span class=n>lockedIndex</span><span class=p>]</span> <span class=o>=</span> <span class=n>particleIndex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// åˆ†é…æ–°èŠ‚ç‚¹
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>newNodeIndex</span> <span class=o>=</span> <span class=n>atomicSub</span><span class=p>(</span><span class=o>&amp;</span><span class=n>maxNodeIndex</span><span class=p>,</span> <span class=mi>1</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// è®¾ç½®æ–°èŠ‚ç‚¹ä¸­å¿ƒä¸åŠå¾„
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>px</span><span class=p>[</span><span class=n>newNodeIndex</span><span class=p>]</span> <span class=o>=</span> <span class=n>currentX</span> <span class=o>-</span> <span class=n>r</span> <span class=o>+</span> <span class=n>dx</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>py</span><span class=p>[</span><span class=n>newNodeIndex</span><span class=p>]</span> <span class=o>=</span> <span class=n>currentY</span> <span class=o>-</span> <span class=n>r</span> <span class=o>+</span> <span class=n>dy</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>pz</span><span class=p>[</span><span class=n>newNodeIndex</span><span class=p>]</span> <span class=o>=</span> <span class=n>currentZ</span> <span class=o>-</span> <span class=n>r</span> <span class=o>+</span> <span class=n>dz</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>pm</span><span class=p>[</span><span class=n>newNodeIndex</span><span class=p>]</span> <span class=o>=</span> <span class=n>r</span> <span class=o>*</span> <span class=mf>0.5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=c1>// åˆå§‹åŒ–å­èŠ‚ç‚¹
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>for</span> <span class=p>(</span><span class=kt>int</span> <span class=n>k</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span> <span class=n>k</span> <span class=o>&lt;</span> <span class=n>numChildren</span><span class=p>;</span> <span class=n>k</span><span class=o>++</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>childList</span><span class=p>[</span><span class=n>childListIndex</span><span class=p>(</span><span class=n>newNodeIndex</span><span class=p>,</span> <span class=n>k</span><span class=p>)]</span> <span class=o>=</span> <span class=n>EMPTY</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=c1>// å°†æ—§ç²’å­å’Œæ–°ç²’å­åˆ†åˆ«æ”¾å…¥ä¸åŒæ§½
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=n>childList</span><span class=p>[</span><span class=n>childListIndex</span><span class=p>(</span><span class=n>newNodeIndex</span><span class=p>,</span> <span class=n>oldChildSlot</span><span class=p>)]</span> <span class=o>=</span> <span class=n>oldParticle</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>childList</span><span class=p>[</span><span class=n>childListIndex</span><span class=p>(</span><span class=n>newNodeIndex</span><span class=p>,</span> <span class=n>newChildSlot</span><span class=p>)]</span> <span class=o>=</span> <span class=n>newParticle</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>__threadfence</span><span class=p>();</span>
</span></span><span class=line><span class=cl>        <span class=n>childList</span><span class=p>[</span><span class=n>lockedIndex</span><span class=p>]</span> <span class=o>=</span> <span class=n>newNodeIndex</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><hr><h2 id=å¹¶å‘ä¸åŒæ­¥>å¹¶å‘ä¸åŒæ­¥</h2><p>ç”±äºå¤šçº¿ç¨‹åŒæ—¶æ„å»ºæ ‘ï¼Œå¿…é¡»ä¿è¯ä»¥ä¸‹ä¸¤ç‚¹ï¼š</p><ol><li><p><strong>åŸå­æ“ä½œ</strong></p><ul><li><code>atomicCAS</code>ï¼ˆCompare And Swapï¼‰é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶æ’å…¥åŒä¸€ä½ç½®</li><li><code>atomicSub</code> åˆ†é…æ–°èŠ‚ç‚¹ç´¢å¼•</li></ul></li><li><p><strong>å†…å­˜åŒæ­¥</strong></p><ul><li><code>__threadfence()</code> ç¡®ä¿å…¶ä»–çº¿ç¨‹èƒ½çœ‹åˆ°å·²æ›´æ–°çš„èŠ‚ç‚¹æ•°æ®</li></ul></li></ol><p><strong>æ³¨æ„</strong>ï¼šç¨ å¯†å­˜å‚¨çš„èŠ‚ç‚¹æ•°ç»„åœ¨åˆ†é…æ—¶æ˜¯å€’ç€ä½¿ç”¨çš„ï¼Œæ‰€ä»¥ä¸ä¼šå’Œç²’å­ç´¢å¼•å†²çªã€‚</p><hr><h2 id=æ€§èƒ½åˆ†æä¸ä¼˜åŒ–å»ºè®®>æ€§èƒ½åˆ†æä¸ä¼˜åŒ–å»ºè®®</h2><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>å†…å­˜å ç”¨å¤§å¹…å‡å°‘ï¼ˆåªå­˜å®é™…å­˜åœ¨çš„èŠ‚ç‚¹ï¼‰</li><li>ç´¢å¼•ç´§å‡‘ï¼Œç¼“å­˜å‘½ä¸­ç‡é«˜</li><li>éå†æ•ˆç‡æå‡</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li>èŠ‚ç‚¹åˆ†é…ä¾èµ– <code>atomicSub</code>ï¼Œåœ¨æé«˜å¹¶å‘ä¸‹å¯èƒ½æˆä¸ºç“¶é¢ˆ</li><li>å®ç°å¤æ‚åº¦é«˜äºç¨€ç–å­˜å‚¨</li></ul><p><strong>ä¼˜åŒ–æ–¹å‘</strong>ï¼š</p><ul><li>æ‰¹é‡åˆ†é…èŠ‚ç‚¹ç´¢å¼•ï¼Œå‡å°‘ <code>atomicSub</code> æ¬¡æ•°</li><li>åˆå¹¶é”ä¸èŠ‚ç‚¹å†™å…¥æ­¥éª¤ï¼Œå‡å°‘åŸå­æ“ä½œå†²çª</li><li>åœ¨å…±äº«å†…å­˜ä¸­ç¼“å­˜éƒ¨åˆ†å­èŠ‚ç‚¹</li></ul><hr><h2 id=æ€»ç»“ä¸åº”ç”¨åœºæ™¯>æ€»ç»“ä¸åº”ç”¨åœºæ™¯</h2><p>ç¨ å¯†å­˜å‚¨ç‰¹åˆ«é€‚åˆï¼š</p><ul><li>ç²’å­æ•°é‡å¤§ã€ç©ºé—´åˆ†å¸ƒå‡åŒ€çš„æ¨¡æ‹Ÿï¼ˆå¦‚ SPHã€N-bodyï¼‰</li><li>å¯¹å†…å­˜å ç”¨æ•æ„Ÿçš„ GPU åº”ç”¨</li><li>éœ€è¦é¢‘ç¹é‡å»ºæ ‘ç»“æ„çš„å®æ—¶è®¡ç®—</li></ul><p>ä¸ç¨€ç–å­˜å‚¨ç›¸æ¯”ï¼Œç¨ å¯†å­˜å‚¨åœ¨ GPU ç¯å¢ƒä¸‹é€šå¸¸èƒ½è·å¾—æ›´é«˜çš„æ€§èƒ½ä¸æ›´ä½çš„å†…å­˜æ¶ˆè€—ï¼Œå°¤å…¶æ˜¯åœ¨èŠ‚ç‚¹æ•°é‡æ¥è¿‘ç²’å­æ•°é‡æ—¶ä¼˜åŠ¿æ˜æ˜¾ã€‚</p><hr><p><strong>å‚è€ƒå®ç°</strong>ï¼šæœ¬æ–‡çš„æ„å»ºæ€è·¯æºè‡ª CUDA å¹¶è¡Œ Barnes-Hut æ ‘æ„å»ºçš„å¸¸è§æ¨¡å¼ï¼Œå¹¶ç»“åˆäº†ä½ çš„åŸå§‹ä»£ç è¿›è¡Œç¨ å¯†åŒ–å¤„ç†ã€‚</p></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-ND 4.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{const e=document.querySelector(".main-article");renderMathInElement(e,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>ç›¸å…³æ–‡ç« </h2><div class=related-content><div class="flex article-list--tile"><article><a href=/zh-cn/posts/cudatreecode/blog-post-treecode/><div class=article-details><h2 class=article-title>åŸºäºæ ‘ç»“æ„çš„ SPH ç²’å­é¢†åŸŸæœç´¢</h2></div></a></article><article><a href=/zh-cn/posts/parallel-reduction-with-cuda/blog-parallel-reduction-with-cuda/><div class=article-details><h2 class=article-title>7 Step Optimization of Parallel Reduction with CUDA</h2></div></a></article><article><a href=/zh-cn/posts/blog-post-2/><div class=article-details><h2 class=article-title>SPH ç²’å­é¢†åŸŸæœç´¢</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2025 Example Person</section><section class=powerby>ä½¿ç”¨ <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> æ„å»º<br>ä¸»é¢˜ <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> ç”± <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> è®¾è®¡</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>